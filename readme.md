NodeCGで動作する配信画面と管理ツールです。

# 導入方法
## 初期条件
* Windows 11（10以降はおそらくOK）
* Powershell 7以降
* Node.jsインストール済み

## NodeCGの導入・プロジェクト構築
[https://qiita.com/nanana08/items/73e3dcb33676c93eddac]

このリポジトリを *クローンせずに* 以下を実行

```powershell
# cliをインストール
npm install --global nodecg-cli@latest

# プロジェクトを作成
nodecg setup

# bundles配下にこのリポジトリをクローン
nodecg install student-team-conf/2024-live-layout
```

## トラブルシューティング
### Windows Powershell (Ver. 5以下)でnodecg setupに失敗する
```nodecg setup```を行おうとすると、「このシステムではスクリプトの実行が無効になっているため…」と出る。

* Powershell (Ver. 7以降)をインストールする。
    * ターミナルを開いて一番上に出てくるリンクからPowershellをインストール。
* ターミナルを再度開いて、既定のターミナルを```Windows Powershell```から```Powershell```に変更。
* VSCodeなどでターミナルを動かしている場合は一度元のターミナルを閉じて新しくターミナルを開き、```Powershell```に切り替える。

# 起動
```powershell
npm start
```

```localhost:9090```にアクセス。

# データ形式
```graphics/json/```内にデータのJSONファイルがあるのでそれを編集、保存する。NodeCG起動中での変更の場合は、NodeCGの「データの更新」画面で更新ボタンを忘れずに。

## presentation.json
各発表・発表者の情報。複数の発表をリストにした形式で与える。```graphics/speaker-data/```に移動済。

```presentation.json
[
    {
        "name": "矢口 太郎（Taro YAGUCHI）",
        "title": "情報系に詳しくない人との議論のトリセツ - 学園祭運営団体での情報系部署の管理職を経験して",
        "info": [
            {
                "type": ["career"],
                "value": "早稲田大学 理工学部 機械工学科 学部3年"
            },
            {
                "type": ["career"],
                "value": "早稲田大学 理工展連絡会 66期情報局長"
            },
            {
                "type": ["account", "dev"],
                "value": "@hogehoge"
            },
            {
                "type": ["account", "discord"],
            }
        ]
    },
    {
        "name": "矢口 むぎ（Mugi YAGUCHI）",
        "title": "VTuberによる学園祭の宣伝",
        "info": [
            {
                "type": ["account", "x"],
                "value": "@waseda_tsumugi"
            },
            {
                "type": ["account", "qiita"],
                "value": "@hogehoge"
            },
            {
                "type": ["career"],
                "value": "早稲田大学 理工学部 学部3年"
            }
        ],
        "time": "14:30"
    }
]
```

各発表の情報の体裁は以下の通り。

* name: 発表者名。このまま表示されるので体裁は揃えると良い。
* title: 発表名。表示の際は、単語に応じた分かち書きと改行が自動で行われる（budoux）。
* time: 発表の開始時間。このまま表示される。
* info: 各種情報のリスト。
    * type: 情報の種類のリスト。CSSのクラスとしてそのまま反映される。
        * career: 職歴や学歴など。
        * account: SNSなどのアカウントなど。必ず対応する以下のサービス1つを併記する。指定したサービスのロゴとテーマカラーが自動で反映されて表示される。
            * dev: dev.to
            * discord
            * facebook
            * github
            * hatena: はてなブログ
            * instagram（非対応）
            * medium
            * niconico
            * note
            * qiita
            * twitch
            * x
            * youtube
            * zenn

## notice.json
画面下部に繰り返し表示されるお知らせ。

```notice.json
[
    "$schedule 0",
    "$schedule 1",
    "$schedule 2",
    "早稲田大学 西早稲田キャンパス 57号館202教室にて開催中です！現地でもご観覧いただけます。",
    "理工展カンファレンスは、早稲田大学理工3学部の学園祭、「理工展」内の企画として開催しています。"
]
```

基本的にはお知らせをリストで入力するが、状況に応じて表示内容が変わるコマンドが存在する。

* $schedule x: この後のスケジュール（発表）を自動的に反映して表示する。
    * ```x```には数字が入る。これは設定画面にて指定した、お知らせでの発表者に対して```x```人後ろの発表者を表示するという意味になる。例の場合は、1つ目のお知らせは設定画面で指定した発表、2つ目のお知らせはその次の発表者、3つ目のお知らせはさらに次の発表者となる。

# 会場での手順
## OBSの設定
* 発表時間と準備時間それぞれのシーンを用意する。
    * ビデオなどの配置も済ませておく。
* スタジオモードに切り替えて、切り替え予定のシーンの映像も見られるようにしておく。

## 当日の手順
### 開始時（ライブ開始前）
* NodeCGやカメラなど起動できるものはあらかじめ起動してからOBSを立ち上げる。
    * 特にNodeCGは起動しておくと同時に全てロードされるので字幕のタイミングが揃うなどメリットが多い。
* 発表時間側の表示を最初に発表する人に設定して「更新」を押す。
* 待機画面を表示しておく場合は待機画面を用意してあらかじめ表示しておく。
* YouTubeのストリームキーを入力して、配信の準備が完全にでき次第、OBSで配信開始を押す。

### 発表の合間の準備時間（待機画面）
* （任意）発表一覧の表示をあらかじめ消していた場合は、設定画面の「待機画面のアニメーション」にある「切り替え」ボタンを押して、この後の発表一覧を出現させる。
* 発表時（切り替え後）のシーンを指定する。
* 発表画面を次の発表者に設定しておく。
* 発表開始前に切り替え後の発表画面の状態を確認。
    * 表示情報は間違っていないか。
    * カメラとスライドは映っているか。
        * クリッピング範囲の調整
    * リモート発表ならカメラのないシーンにするなど発表形態にも注意。
* シーンの切り替えを行う。

### 発表中（発表画面）
* すぐに、フッターに表示するお知らせにおける発表者を次の発表者に設定する。
* 切り替え後の画面はおそらく待機画面に設定されているはずだが、確認する。
* 待機画面を次の発表者に設定しておく。
* 待機画面が正しい情報を表示しているか確認する。
* （任意）設定画面の「待機画面のアニメーション」にある「切り替え」ボタンを押して、この後の発表一覧を消しておくと演出的に良い。
* 発表が終わったらシーンを切り替える。

### （随時）情報修正・変更
* JSON側で情報を変更する。
* データの更新画面で「更新」を押す。

#### 変更したデータの反映タイミング
* 名前やタイトルなど、固定表示のものはすぐ変更が反映される。
* それ以外のアニメーションで切り替わるものはアニメーションで出現する際に反映される。
